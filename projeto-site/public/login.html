<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,700" rel="stylesheet">
    <link rel="stylesheet" href="./css/login.css">
    <link rel="shortcut icon" type="image/jpg" href="./media/favicon.png" />
    <title>Entrar | Erick Leme</title>
</head>

<body>
    <video autoplay muted loop id="myVideo">
        <source src="./media/vortex2.mp4" type="video/mp4">
      </video>
    <div class="layer">
        <form class="login" id="form_login" method="post" onsubmit="return entrar()">
            <h1>Bem vindo</h1>
            <input class="ipt" type="text" id="login" name="login" placeholder="Usuário ou e-mail" required/>
            <br>
            <input class="ipt" type="text" id="password" name="senha" placeholder="Senha" required/>
            <br>
            <button class="btn" type="submit" id="btn_entrar">Entrar</button>
        </form>
        Não tem uma conta? <a href="cadastro.html">Clique aqui</a>
    </div>
</body>

</html>
<script>

    function entrar() {
        var formulario = new URLSearchParams(new FormData(form_login));
        fetch("/usuarios/autenticar", {
            method: "POST",
            body: formulario
        }).then(resposta => {
            
            if (resposta.ok) {

                resposta.json().then(json => {

                    sessionStorage.login_usuario_meuapp = json.name_user;
                    sessionStorage.nome_usuario_meuapp = json.name_user;
                    
                    window.location.href = 'index.html';
                });

            } else {

                alert('Erro de login!');

                response.text().then(texto => {
                    console.error(texto);
                    finalizar_aguardar(texto);
                });
            }
        });

        return false;
    }

    function aguardar() {
        btn_entrar.disabled = true;
        img_aguarde.style.display='block';
        div_erro.style.display='none';
    }

    function finalizar_aguardar() {
        btn_entrar.disabled = false;
        img_aguarde.style.display='none';
        div_erro.style.display='block';
    }

</script>